<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">

    <body>

        <!-- Fragmento para agregar nueva promoción (botón en el listado) -->
        <section th:fragment="agregar">
            <div class="row py-4 mb-2 bg-light">
                <div class="col-md-9"></div>
                <div class="col-md-3 text-end">
                    <a th:href="@{/promocion/nuevo}" class="btn btn-primary btn-lg">
                        <i class="fas fa-plus"></i> Nueva Promoción
                    </a>
                </div>
            </div>
        </section>

        <!-- Fragmento para el listado de promociones -->
        <section th:fragment="listado">
            <div class="card shadow-sm bg-light">
                <div class="card-header bg-dark text-white">
                    <h4>Listado de Promociones</h4>
                </div>
                <div class="card-body">
                    <div th:if="${promociones != null and !promociones.isEmpty()}">
                        <table class="table table-striped table-hover">
                            <thead class="table-warning">
                                <tr>
                                    <th>#</th>
                                    <th>Imagen</th>
                                    <th>Título</th>
                                    <th>Descuento</th>
                                    <th>Vigencia</th>
                                    <th>Activa</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="p : ${promociones}">
                                    <td th:text="${p.idPromocion}"></td>
                                    <td>
                                        <img th:if="${p.imagen != null and !p.imagen.isEmpty()}"
                                             th:src="@{${p.imagen}}"
                                             alt="Promoción"
                                             style="width:80px; height:60px; object-fit:cover; border-radius:8px;">
                                            <span th:unless="${p.imagen != null and !p.imagen.isEmpty()}" class="text-muted">Sin imagen</span>
                                    </td>
                                    <td th:text="${p.titulo}"></td>
                                    <td th:text="${p.porcentajeDescuento != null ? ${p.porcentajeDescuento} + '%' : 'N/A'}"></td>
                                    <td th:text="${#temporals.format(p.fechaInicio, 'dd/MM/yyyy')} + ' - ' + ${#temporals.format(p.fechaFin, 'dd/MM/yyyy')}"></td>
                                    <td>
                                        <span th:text="${p.activa} ? 'Sí' : 'No'"
                                              th:classappend="${p.activa} ? 'text-success fw-bold' : 'text-danger fw-bold'"></span>
                                    </td>
                                    <td>
                                        <form th:action="@{/promocion/modificar}" method="post" style="display:inline;">
                                            <input type="hidden" name="idPromocion" th:value="${p.idPromocion}"/>
                                            <button type="submit" class="btn btn-warning btn-sm">
                                                <i class="fas fa-pencil-alt"></i> Editar
                                            </button>
                                        </form>
                                        <form th:action="@{/promocion/eliminar}" method="post" style="display:inline;" class="ms-2">
                                            <input type="hidden" name="idPromocion" th:value="${p.idPromocion}"/>
                                            <button type="submit" class="btn btn-danger btn-sm"
                                                    onclick="return confirm('¿Seguro que deseas eliminar esta promoción?')">
                                                <i class="fas fa-trash"></i> Eliminar
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div th:if="${promociones == null or promociones.isEmpty()}" class="text-center py-5 text-muted">
                        <h5>No hay promociones registradas aún.</h5>
                    </div>
                </div>
            </div>
        </section>

        <!-- Fragmento para el formulario de editar/nuevo -->
        <section th:fragment="editar">
            <div class="row justify-content-center mt-4">
                <div class="col-lg-8">
                    <div class="card shadow-sm bg-light">
                        <div class="card-header bg-warning text-dark">
                            <h4 th:text="${promocion.idPromocion == null} ? 'Nueva Promoción' : 'Editar Promoción'">Promoción</h4>
                        </div>
                        <div class="card-body">
                            <form th:action="@{/promocion/guardar}"
                                  th:object="${promocion}"
                                  method="post"
                                  enctype="multipart/form-data"
                                  class="was-validated">
                                <input type="hidden" th:field="*{idPromocion}"/>

                                <div class="mb-3">
                                    <label class="form-label">Título</label>
                                    <input type="text" class="form-control" th:field="*{titulo}" required/>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Descripción</label>
                                    <textarea class="form-control" th:field="*{descripcion}" rows="4" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Porcentaje de Descuento (%)</label>
                                    <input type="number" step="0.01" class="form-control" th:field="*{porcentajeDescuento}"/>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Fecha Inicio</label>
                                        <input type="date" class="form-control" th:field="*{fechaInicio}" required/>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Fecha Fin</label>
                                        <input type="date" class="form-control" th:field="*{fechaFin}" required/>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Imagen de la promoción</label>
                                    <input type="file" class="form-control" name="imagenFile"/>
                                    <div th:if="${promocion.imagen != null and !promocion.imagen.isEmpty()}" class="mt-3">
                                        <img th:src="@{${promocion.imagen}}" alt="Imagen actual" style="max-height:200px; border-radius:8px;"/>
                                    </div>
                                </div>
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" th:field="*{activa}"/>
                                    <label class="form-check-label">Activa</label>
                                </div>
                                <div class="text-center">
                                    <a th:href="@{/promocion/listado}" class="btn btn-secondary me-2">Cancelar</a>
                                    <button type="submit" class="btn btn-success">Guardar Promoción</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Fragmento para confirmar eliminación (modal simple con JS) -->
        <section th:fragment="confirmarEliminar">
            <!-- Puedes usar un modal Bootstrap o confirm() de JS como en el listado -->
            <!-- Ya está manejado con onclick en el botón eliminar del listado -->
        </section>

    </body>
</html>